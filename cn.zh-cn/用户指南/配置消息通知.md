# 配置消息通知<a name="ZH-CN_TOPIC_0085720906"></a>

MRS联合消息通知服务\(SMN\)，采用主题订阅模型，提供一对多的消息订阅以及通知功能，能够实现一站式集成多种推送通知方式（短信和邮件通知）。

## 操作场景<a name="section4424935411854"></a>

在MRS管理控制台，按照集群维度，在集群信息页面的告警页签中能够提供选择是否使能通知服务，只有对应集群开关开启以后，才能实现以下场景的功能：

-   在用户订阅了通知服务之后，当集群出现扩容成功/失败、缩容成功/失败、终止成功/失败、弹性升缩成功/失败的场景下，由MRS管理面通过邮件或短信方式通知对应用户。
-   管理面检查大数据集群的告警信息，如果大数据集群的告警信息影响到服务的使用，其告警级别达到致命时，则发送信息通知给对应租户。
-   在用户集群的ECS机器被删除、关机、修改规格、重启、更新OS的行为，会导致大数据集群异常，当检测到用户的虚拟机出现以上状态的时候，发送通知给对应用户。

## 操作步骤<a name="section2769747914132"></a>

**创建主题**

主题是消息发布或客户端订阅通知的特定事件类型。它作为发送消息和订阅通知的信道，为发布者和订阅者提供一个可以相互交流的通道。

1.  登录管理控制台。
2.  选择“应用服务” \> “消息通知服务”。

    进入消息通知服务页面。

3.  在左侧导航栏，选择“主题管理” \> “主题”。

    进入主题页面。

4.  在主题页面，单击“创建主题”，开始创建主题。

    此时将显示“创建主题”对话框。

5.  在“主题名称”框中，输入主题名称，在“显示名”框中输入相关描述。

**向主题添加订阅**

要接收发布至主题的消息，您必须添加一个订阅终端节点到该主题。消息通知服务会发送一条订阅确认的消息到订阅终端，订阅确认的消息将在48小时内有效。如果订阅者在48小时之内确认订阅，将会收到推送至主题的消息。如果订阅者在48小时之内没有确认订阅，则需要再次给订阅者发送订阅确认的消息。

1.  登录管理控制台。
2.  选择“应用服务” \> “消息通知服务”。

    进入消息通知服务页面。

3.  在左侧导航栏，选择“主题管理” \> “主题”。

    进入主题页面。

4.  在主题列表中，选择您要向其添加订阅者的主题，在右侧“操作”栏单击“添加订阅”。

    此时将显示“添加订阅”对话框。

    其中：协议参数选项为“短信”、“邮件”、“HTTP”、“HTTPS”、FunctionGraph（函数）、FunctionGraph（工作流）以及DMS。

    订阅终端参数为订阅的终端地址，短信、邮件、HTTP以及HTTPS终端支持批量输入，批量添加时，每个终端地址占一行。最多可输入10个终端。


1.  单击“确定”。

新增订阅将显示在页面下方的订阅列表中。

**向订阅者发送消息**

1.  登录MRS管理控制台。
2.  选择“集群列表 \> 现有集群“，选中一运行中的集群并单击集群名，进入集群信息页面。
3.  单击“告警列表“页签。
4.  单击“配置消息通知”，进入配置消息通知页面。
5.  开启“消息通知”，并选择主题。
6.  单击“确定“。

